---
title: dont create db on task commands
status: todo
priority: medium
---

# Description

## Current

when running `kanbatte task`, it will create `local.db`


## Expectations

when running `kanbatte task` or any task related tasks, ther e should be no `local.db` being created or accessed

`local.db` should only be created when explicitly running `kanbatte db setup`

# Key Reason

The database client is being initialized at module load time in [src/cli.js:40](src/cli.js#L40), which creates the `local.db` file immediately when the CLI starts, regardless of which command is being executed. This happens because:

1. The `createClient(config)` call is executed at the top level of the module
2. The config points to `file:${dbPath}` where `dbPath` is `local.db` in the current directory
3. LibSQL creates the database file automatically when the client is initialized

Task commands (`kanbatte task create`, `kanbatte task list`, `kanbatte task locate`) only work with file-based task management and don't need database access, but they still trigger the database creation due to this early initialization.

# Fix Plan

The current issue is that database client initialization happens at module load time, creating `local.db` even when not needed. However, the requirement is stricter: `local.db` should ONLY be created when explicitly running `kanbatte db setup`.

1. **Remove automatic database client initialization**: Eliminate the top-level `createClient` call in [src/cli.js:40](src/cli.js#L40)
2. **Make database operations optional**: All session and agent commands should check if database exists before attempting operations
3. **Require explicit database setup**: Database-dependent commands should fail gracefully with a helpful message if `local.db` doesn't exist
4. **Update database setup command**: Ensure `kanbatte db setup` is the ONLY command that creates the database
5. **Add database existence checks**: Create helper functions to check if database exists before operations

Implementation approach:
- Remove the global `db` client initialization
- Create a `getDatabaseClient()` helper that returns null if database doesn't exist
- Update all database-dependent commands to handle null database client gracefully
- Modify session and agent commands to require explicit database setup first
- Keep task commands completely independent and working without database
