
# Kanbatte CLI API

Kanbatte is a task management for AI agents.
There are 2 core concepts:
`tasks` and `sessions`.

Tasks are stored in git itself under tasks folder. They are numbered tasks. Each task is just a markdown file.


Sessions are the sessions with AI agents. Each session can usually create a task. or implmeent a task for example, or anything else, does not have to use a task.
This data, we will store against a db/server for collaboration. could also be hosted locally if on need for collaboration.


## Tasks

Tasks are organized in the below structure.
We envision that every repo will have a tasks folder. 


Design considerations:
- we group into 000, 100, 200 ... 1000, 1100, folders so each holder can hold 100 tasks. it makes a bit more navigable for larger projects.
- tasks start ast TASK-001.md instead of TASK-1.md. This is just for sake of sorting. folder sorting will break at the folder 1000, but that is ok. is a very low frequency thing. and still tollerable because folders are very few.

Tasks have task types. user can specify any that you want. TASK/FEAT/BUG etc...


```
tasks/config.yaml
tasks/TASK/
    000/
      TASK-001.md
      TASK-002.md
      ...
      TASK-099.md
    100/
      TASK-100.md
      TASK-101.md
      ...
      TASK-199.md
    200/
      TASK-200.md
tasks/FEAT/
    000/
      001.md
      002.md
tasks/BUG/
    000/
      001.md
      002.md
```


example task file content

```md
---
title: Task Title
status: todo
prioriti: low
---

# Description

Description ...

# More sections

...

```

everything below description is free form, can add more sections as needed

status can be only `todo` or `done`. we don't store in-progress because it will be done by the session itself.

we may add more somethings later such as assignee

priority can be: `low`, `medium`, `high`


### Tasks CLI

## Commands

### Creating Tasks

**Create a new task with inline parameters:**
```bash
kanbatte task create -p 'TASK' -t 'title of the task' -d 'task description' -r 'high'
# will create file with correct folder with correct content

kanbatte task create --type 'TASK' --title 'title of the task' --description 'task description' -priority 'high'
```

task type and title are required.

description and priority are optional

for create. basically need to look at folder and files to get the latest id, and create new one with correct id.


### Listing tasks

only need to print out as table, can support only 1 format for now.

```bash
kanbatte task list -p 'TASK'
# print out a table of taskId, status,  title

kanbatte task list -p 'TASK' -s 'todo'
# filter by status

kanbatte task list -p 'TASK' -s 'todo' -r 'high,medium'
# filter by status, and priority

```

### Update tasks

Will just update the file content manually. This makes is much simpler

```bash

kanbatte task locate TASK-001

## just a convenince method  will return the relative path of the task ./tasks/TASK/000/001.md
## for example can do `kanbatte task locate TASK-001 | grep vim`

```




## Sessions

Important: Projects are completely unrelated to task types.
Each session needs to be attached to a project. Because in the project we have the git reposiotry information.

```bash
kanbatte session project create -p project-name -r git@github.com:example/example.git -d description
kanbatte session project create --project project-name --repository git@github.com:example/example.git --name project-name --description description

kanbatte session project update -p project-name -r git@github.com:example/example.git -d description

kanbatte session project list # shows a table with those columns. project-name, repository, description
```


Sessions is used to structure agentic coding data, and make it useful, especially for collaboration, and build UI on top of it.

```bash

kanbatte session queue -p project-name 'hey coding agent. Create a task to do ...'
kanbatte session queue -p project-name  'hey coding agent. Start working on task TASK-001'
kanbatte session queue -p project-name 'hey coding agent. Create a task to do ...'
# return id of the session

```

A session id will be autogenerated from the server

Note this is not interactive. this will just make a call to the backend/db, and close immediately. it will create a session that is wating to be picked up.
A separete process, in local or in serve where it has access to the coding agents, will see that there is a new session pending, and will pick it up for the agent to work on it.
While the agent is working on it, it will update the progress by updating the content, and also the progress.


Commands for agent to use:

```bash
kanbatte session append  -i 'session id' -m '[{...}]' # the json will be the copmletion API messages format
```

This will be used for both user and agents. devs will use this API to ask more things


```bash
kanbatte session append -i 'session id' -t -m '[{...}]' 
kanbatte session append --id 'session id' --stop --messages '[{...}]' 
```

a `stop` option will tell the agent to stop working. and resume immediately so it will immediately pick up the last message sent by the user.


Below if an example of the completion API format:

```json
{
  "messages": [
    {
      "role": "system",
      "content": "You are a friendly assistant who explains things clearly."
    },
    {
      "role": "user",
      "content": "Explain quantum entanglement in simple terms."
    },
    {
      "role": "assistant",
      "content": "Quantum entanglement is when two particles become linked, so that the state of one instantly affects the other, no matter the distance between them."
    },
    {
      "role": "user",
      "content": "Can you give a real-world analogy?"
    }
  ],
}
```

Update session status

```bash
kanbatte session status -i 'session id' 'in-progress' # updates the status of the session
kanbatte session status -i 'session id'  # just return the current status
```

session data structure:

```js

session.id

session.messages

session.status


```

session status can be:
- `ready`: initial status
- `in-progress`: when agent starts working on it
- `review`: when agent finish working and needs a person to review
- `done`: person verifies all is good and moves to done



View sessions. 

```bash
kanbatte session list -p project-name  # output a table in the terminal. with 3 columsn: session id, status, first sentence and last sentence, start date, last update date

kanbatte session list -p project-name  -s 'ready,in-progress'

kanbatte session view -i 'session id' # print out in markdown format

kanbatte session view -i 'session id' | less
```

Sessions should be implmented using [eventLog](./eventLog.md)
Remove all previous unnecessary stuff like comments, followups etc...



## Server


Finanlly, this is to be run on the server side which will spawn an agent to work on the session

```bash
kanbatte agent start
```

This will do this:

- loop:
  - check for all ready sessions
  - pick first sessions:
    - make sure repository is downloaded in ./repositories folder
    - create a git worktree with the session id as branch name
    - start coding agent under this worktree
      - set session status as `in-progress`
      - listen to all updates from agent, and send them to db. (same behavior as `kanbatte session append`)
      - once done, set session status as `review`


